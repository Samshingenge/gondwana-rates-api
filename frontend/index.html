<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gondwana Collection - Accommodation Rates</title>
  <meta name="description" content="Search and compare accommodation rates at Gondwana Collection properties"/>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    :root{
      --primary:#2c5530; --secondary:#5d8a3a; --light:#f8fffe; --mid:#e8f5e8;
      --text:#333; --muted:#666; --error:#dc3545; --ok:#28a745;
      --shadow:0 8px 25px rgba(44,85,48,0.15);
    }
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Noto Sans",sans-serif;
      background:linear-gradient(135deg,#2c5530 0%,#5d8a3a 50%,#8fbc8f 100%);
      min-height:100vh; padding:20px; color:var(--text);
      overflow-x:hidden;
    }
    .container{
      width:min(100%,1100px); margin:0 auto; background:#fff; border-radius:20px;
      padding:30px; box-shadow:0 20px 40px rgba(0,0,0,0.2); backdrop-filter:blur(10px);
    }
    .header{ text-align:center; margin-bottom:30px; }
    .logo-title{ display:flex; align-items:center; justify-content:center; gap:12px; }
    .logo{ width:clamp(28px,6vw,40px); height:clamp(28px,6vw,40px); object-fit:contain; }
    .header h1{
      font-size:clamp(2rem,5vw,3rem);
      background:linear-gradient(45deg,#2c5530,#5d8a3a);
      -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent;
      margin-bottom:8px;
    }
    .header p{ color:var(--muted); }

    .booking-form{ background:var(--light); padding:24px; border-radius:16px; border:2px solid var(--mid); box-shadow:var(--shadow); }
    .form-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:20px; margin-bottom:16px; }
    .form-group{ display:flex; flex-direction:column; gap:8px; }
    label{ font-weight:600; color:var(--primary); }
    input, select{
      padding:12px 14px; border:2px solid #d4edda; border-radius:8px; font-size:16px; background:#fff;
      transition:border-color .2s, box-shadow .2s; width:100%;
    }
    input:focus, select:focus{ outline:none; border-color:#5d8a3a; box-shadow:0 0 0 3px rgba(93,138,58,.12); }

    .date-wrapper{ display:flex; gap:8px; align-items:center; flex-wrap:nowrap; }
    .date-btn{ padding:10px 14px; background:linear-gradient(45deg,#2c5530,#5d8a3a); color:#fff; border:none; border-radius:8px; cursor:pointer; }
    .sr-only{ position:absolute!important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

    .ages-container{ display:flex; flex-wrap:wrap; gap:10px; }
    .age-row{ display:flex; align-items:center; gap:8px; }
    .remove-age-btn{ background:#dc3545; color:#fff; border:none; border-radius:8px; padding:8px 12px; cursor:pointer; }
    .btn{
      background:linear-gradient(45deg,#2c5530,#5d8a3a); color:#fff; border:none; padding:12px 18px;
      border-radius:10px; cursor:pointer; font-weight:600; box-shadow:0 4px 15px rgba(44,85,48,.25);
    }
    .btn.secondary{ background:#6c757d; }
    .btn.danger{ background:#dc3545; color:#fff; }          /* red for unavailable */
    .btn.danger:hover{ filter:brightness(.95); }
    .btn:disabled{ opacity:.6; cursor:not-allowed; }
    .add-age-btn{ background:#6c757d; }

    .hint{ display:block; color:#666; font-size:12px; }
    .results-section{ margin-top:24px; }
    #resultsContainer{ min-height:0; }
    .error{ background:#f8d7da; color:#721c24; padding:12px; border-radius:8px; border-left:4px solid #dc3545; }
    .success{ background:#d4edda; color:#155724; padding:12px; border-radius:8px; border-left:4px solid #28a745; }

    /* ===== Modal (shared styles) ===== */
    .modal{ position:fixed; inset:0; background:rgba(0,0,0,.45); display:none; align-items:center; justify-content:center; padding:clamp(8px,3vw,24px); z-index:9999; }
    .modal[aria-hidden="false"]{ display:flex; }
    .modal__panel{ background:#fff; color:#333; width:min(900px,92vw); max-height:90dvh; border-radius:16px; box-shadow:var(--shadow); overflow:hidden; border:2px solid var(--mid); }
    .modal__header{ display:flex; align-items:center; justify-content:space-between; background:linear-gradient(45deg,#2c5530,#5d8a3a); color:#fff; padding:16px 20px; }
    .modal__title{ font-size:1.1rem; font-weight:700; }
    .modal__body{ padding:16px 20px; max-height:calc(90dvh - 120px); overflow:auto; }
    .modal__footer{ display:flex; gap:10px; justify-content:flex-end; padding:14px 20px; background:#fafafa; border-top:1px solid #eee; }

    .badge{ display:inline-block; padding:4px 10px; border-radius:999px; font-size:.75rem; font-weight:700; }
    .badge.ok{ background:#d4edda; color:#155724; border:1px solid #c3e6cb; }
    .badge.no{ background:#f8d7da; color:#721c24; border:1px solid #f5c6cb; }

    table{ width:100%; border-collapse:collapse; table-layout:auto; }
    th,td{ padding:10px 12px; border-bottom:1px solid #eee; text-align:left; word-break:break-word; }
    th{ background:#f7fbf7; position:sticky; top:0; z-index:1; }
    tfoot td{ font-weight:700; }

    /* Print header (visible only on PDF/print) */
    .print-header{ align-items:center; gap:12px; margin:4px 0 10px; }
    .print-logo{ width:64px; height:64px; object-fit:contain; } /* on-screen */
    .print-title{ font-size:1.1rem; font-weight:800; color:#2c5530; }
    .print-sub{ font-size:.9rem; color:#444; }
    .print-ref{ margin-top:4px; font-size:.85rem; color:#666; }
    .only-print{ display:none; }

    /* Small screens / high zoom */
    @media (max-width:640px){
      .modal__panel{ width:100vw; height:100dvh; max-height:none; border-radius:0; }
      .modal__header{ position:sticky; top:0; z-index:1; }
      .modal__body{ max-height:calc(100dvh - 140px); }
      th,td{ font-size:clamp(12px,2.8vw,14px); padding:8px 10px; }
      .modal__title{ font-size:clamp(16px,4vw,20px); }
      .btn{ padding:10px 14px; }
      .date-wrapper{ flex-wrap:wrap; }
      .date-btn{ width:100%; }
    }

    /* Safe areas */
    @supports (padding: max(0px)) {
      .container {
        padding-left:max(16px, env(safe-area-inset-left));
        padding-right:max(16px, env(safe-area-inset-right));
      }
    }

    /* ===== Toast (Test JSON only) ===== */
    .toast-host {
      position: fixed;
      right: 16px;
      bottom: 16px;
      z-index: 10000;
      pointer-events: none;
    }
    .toast {
      pointer-events: auto;
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
      border-radius: 10px;
      padding: 10px 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,.15);
      font-weight: 600;
      margin-top: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
      animation: toast-in .18s ease-out, toast-out .25s ease-in 2.2s forwards;
    }
    .toast .icon { font-size: 1.1rem; }
    @keyframes toast-in { from { opacity:0; transform:translateY(6px); } to { opacity:1; transform:translateY(0); } }
    @keyframes toast-out { to { opacity:0; transform:translateY(6px); } }

    /* ===== Print layout ===== */
    @media print{
      html,body{ background:#fff !important; -webkit-text-size-adjust:100%; text-size-adjust:100%; }
      body > *:not(.modal){ display:none !important; }
      .modal{ display:block !important; position:static !important; inset:auto !important; background:transparent !important; padding:0 !important; }
      .modal__panel{ box-shadow:none !important; border:none !important; width:auto !important; }
      .modal__header{ display:none !important; } /* replaced by print header */
      .only-print{ display:flex !important; }
      .no-print{ display:none !important; }
      .print-logo{ width:100px !important; height:100px !important; object-fit:contain; } /* 100Ã—100 on PDF */
      .toast-host { display:none !important; }
      table{ page-break-inside:auto; }
      tr{ page-break-inside:avoid; page-break-after:auto; }
      @page{ size:A4; margin:14mm; }
    }
  </style>
</head>
<body data-api="http://localhost:8000/api">
  <div class="container">
    <div class="header">
      <div class="logo-title">
        <img src="./assets/21.webp" alt="Gondwana Logo" class="logo"/>
        <h1>Gondwana Collection</h1>
      </div>
      <p>Discover accommodation rates &amp; availability</p>
    </div>

    <div class="booking-form">
      <h2 style="margin-bottom:10px;color:#2c5530;">Search Accommodation</h2>

      <form id="rateForm" novalidate>
        <div class="form-grid">
          <div class="form-group">
            <label for="unitName">Unit Name</label>
            <select id="unitName" name="unitName" required>
              <option value="">Select a unit type</option>
              <option value="Standard Unit">Standard Unit</option>
              <option value="Deluxe Unit">Deluxe Unit</option>
            </select>
          </div>

          <div class="form-group">
            <label for="arrivalDisplay">Arrival Date (dd/mm/yyyy)</label>
            <div class="date-wrapper">
              <input type="text" id="arrivalDisplay" placeholder="dd/mm/yyyy" readonly/>
              <input type="date" id="arrivalISO" class="sr-only" aria-hidden="true"/>
              <button type="button" class="date-btn" data-open="arrivalISO" aria-label="Open arrival date calendar">ðŸ“…</button>
            </div>
            <small class="hint">Format dd/mm/yyyy</small>
          </div>

          <div class="form-group">
            <label for="departureDisplay">Departure Date (dd/mm/yyyy)</label>
            <div class="date-wrapper">
              <input type="text" id="departureDisplay" placeholder="dd/mm/yyyy" readonly/>
              <input type="date" id="departureISO" class="sr-only" aria-hidden="true"/>
              <button type="button" class="date-btn" data-open="departureISO" aria-label="Open departure date calendar">ðŸ“…</button>
            </div>
            <small class="hint">Must be after arrival</small>
          </div>

          <div class="form-group">
            <label for="occupants">Number of Occupants</label>
            <div style="display:flex;gap:8px;align-items:center;">
              <button type="button" class="btn" data-dec-occupant aria-label="Decrease occupants">âˆ’</button>
              <input type="number" id="occupants" name="occupants" min="1" value="2" required style="max-width:100px;text-align:center;"/>
              <button type="button" class="btn" data-inc-occupant aria-label="Increase occupants">+</button>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>Ages of Occupants</label>
          <div class="ages-container" id="agesContainer"></div>
          <div style="display:flex;gap:8px;margin-top:8px;">
            <button type="button" class="btn add-age-btn" data-add-age>+ Add Age</button>
            <button type="button" class="btn" data-clear-ages style="background:#6c757d;">Clear Ages</button>
          </div>
          <small class="hint">Ages must equal occupants.</small>
        </div>

        <div style="display:flex;gap:10px;flex-wrap:wrap;">
          <button type="submit" class="btn" id="submitBtn">Search Rates</button>
          <button type="button" class="btn secondary" id="testBtn">Test JSON</button>
        </div>
      </form>
    </div>

    <div class="results-section">
      <div id="message"></div>
      <div id="resultsContainer"></div>
    </div>
  </div>

  <!-- ===== Booking Summary Modal ===== -->
  <div class="modal" id="resultModal" aria-hidden="true" aria-labelledby="modalTitle" aria-modal="true" role="dialog">
    <div class="modal__panel print-area" role="document">
      <div class="modal__header">
        <div>
          <div class="modal__title" id="modalTitle">Booking Summary</div>
          <small id="modalRef" style="opacity:.9"></small>
        </div>
        <div style="display:flex;gap:8px;">
          <button id="modalPrint" class="btn secondary" aria-label="Print / Save PDF">Print / Save PDF</button>
          <button id="modalClose" class="btn secondary no-print" aria-label="Close">Close</button>
        </div>
      </div>

      <div class="modal__body">
        <!-- Print-only brand header -->
        <div class="print-header only-print">
          <img src="./assets/21.webp" alt="Gondwana Collection logo" class="print-logo"/>
          <div>
            <div class="print-title">Gondwana Collection Namibia</div>
            <div class="print-sub">Accommodation Booking Summary</div>
            <div id="printHeaderRef" class="print-ref"></div>
          </div>
        </div>

        <div id="printMeta" class="print-meta"
             style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:8px;margin:6px 0 14px;">
          <!-- filled by JS -->
        </div>

        <table>
          <thead>
            <tr>
              <th>Unit</th>
              <th>Arrival</th>
              <th>Departure</th>
              <th>Nights</th>
              <th>Availability</th>
              <th style="text-align:right">Rate</th>
            </tr>
          </thead>
          <tbody id="modalTbody"></tbody>
          <tfoot>
            <tr>
              <td colspan="5" style="text-align:right">Total</td>
              <td id="modalTotal" style="text-align:right">â€”</td>
            </tr>
          </tfoot>
        </table>
      </div>

      <div class="modal__footer no-print">
        <button id="modalConfirm" class="btn">Confirm Booking</button>
      </div>
    </div>
  </div>

  <!-- ===== Date Fix Modal (pops up to pick correct date) ===== -->
  <div class="modal" id="dateModal" aria-hidden="true" aria-labelledby="dateModalTitle" aria-modal="true" role="dialog">
    <div class="modal__panel" role="document" style="max-width:520px;">
      <div class="modal__header">
        <div class="modal__title" id="dateModalTitle">Fix Dates</div>
        <button id="dateModalClose" class="btn secondary no-print" aria-label="Close">Close</button>
      </div>
      <div class="modal__body">
        <p id="dateModalMsg" style="line-height:1.5"></p>
      </div>
      <div class="modal__footer">
        <button id="dateModalPick" class="btn">Choose date</button>
      </div>
    </div>
  </div>

  <!-- Toast host (for Test JSON success prompt only) -->
  <div id="toastHost" class="toast-host" aria-live="polite" aria-atomic="true"></div>

  <script src="./app.js" defer></script>
</body>
</html>
